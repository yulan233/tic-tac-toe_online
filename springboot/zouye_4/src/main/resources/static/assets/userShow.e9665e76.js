import{a as b}from"./index.7f6f19a2.js";import{_ as W,u as z,f as j,r as p,g as v,h as F,o as I,c as L,a as n,b as t,i as s,F as T,t as S,j as q,k as A,n as H,w as K,p as Q,d as X,l as c}from"./index.1f288341.js";const C=g=>(Q("data-v-e3c3f88e"),g=g(),X(),g),Y={class:"usershow_body"},Z={class:"usershow_user"},ee={class:"game_user card-header"},ae={class:"item text"},se={class:"item text"},te={class:"item text"},oe=C(()=>n("div",{class:"game_user card-header"},[n("span",null,"\u6700\u8FD1\u573A\u6B21")],-1)),le={class:"usershow_gamematch"},ne=C(()=>n("div",{class:"game_user card-header"},[n("span",null,"\u4E2A\u4EBA\u8BBE\u7F6E")],-1)),de=c("\u4FEE\u6539\u540D\u5B57"),re=c("\u4FEE\u6539\u5BC6\u7801"),ue=C(()=>n("div",{class:"game_user card-header"},[n("span",null,"\u4E95\u5B57\u68CB")],-1)),ie=c("\u5F00\u59CB\u5339\u914D"),ce=c("\u505C\u6B62"),me={class:"dialog-footer"},pe=c("\u53D6\u6D88"),ve=c("\u786E\u8BA4"),_e={class:"dialog-footer"},fe=c("\u53D6\u6D88"),ge=c("\u786E\u8BA4"),we={class:"my-header"},he=["id"],ke={class:"closeMatch"},be=c(" \u505C\u6B62\u5339\u914D "),Se={name:"userShow",setup(g){let w=z();const V=j();let u=V.WebSocket;const a=p({username:"",id:"",token:"",winRate:"",totalGames:"",winGames:""}),r=p({username:"",password:"",repassword:""}),m=p([]),x=()=>{let o=JSON.parse(sessionStorage.getItem("user"));a.value.token=JSON.parse(sessionStorage.getItem("token")),a.value.username=o.username,a.value.id=o.id,b.post("http://49.232.153.11:6655/api/user/getUserMessage",{id:a.value.id}).then(e=>{e.data.code==200?(a.value.winGames=e.data.data.winGames,a.value.totalGames=e.data.data.totalGames,a.value.winRate=e.data.data.winRate):alert(e.data.msg)})},U=()=>{b.post("http://49.232.153.11:6655/api/gameInfo/getGameInfoById",{id:a.value.id},{headers:{userid:a.value.id,token:a.value.token}}).then(o=>{if(o.data.code==200){m.value=o.data.data;for(const e in m.value)if(Object.hasOwnProperty.call(m.value,e)){const d=m.value[e];d.winner==d.firstId&&(d.winner=d.firstName),d.winner==d.secondId&&(d.winner=d.secondName)}}else o.data.code=="tokenError"?(alert(o.data.msg),w.push("/")):alert(o.data.res)})},_=p(!1),f=p(!1),G=()=>{const o={token:a.value.token,id:a.value.id,username:r.value.username};b.post("http://49.232.153.11:6655/api/user/changeUsername",o,{headers:{userid:a.value.id,token:a.value.token}}).then(e=>{if(_.value=!1,e.data.code==200){alert(e.data.msg),a.value.username=r.value.username;let d=JSON.parse(sessionStorage.getItem("user"));d.username=r.value.username,sessionStorage.setItem("user",JSON.stringify(d)),r.value.username=""}else e.data.code=="tokenError"?(alert(e.data.msg),w.push("/")):alert(e.data.msg)})},O=()=>{if(r.value.password==r.value.repassword){const o={token:a.value.token,id:a.value.id,password:r.value.password};b.post("http://49.232.153.11:6655/api/user/changePassword",o,{headers:{userid:a.value.id,token:a.value.token}}).then(e=>{f.value=!1,e.data.code==200?(alert(e.data.msg),r.value.password="",r.value.repassword=""):e.data.code=="tokenError"?(alert(e.data.msg),w.push("/")):alert(e.data.msg)})}else alert("\u4E24\u6B21\u5BC6\u7801\u4E0D\u5BF9")},$=()=>{window.WebSocket?(u==null&&(u=new WebSocket("ws://49.232.153.11:6655/api/websocket/"+a.value.id+"/"+a.value.token)),u.onerror=function(){},u.onopen=function(){},u.onmessage=function(o){const e=JSON.parse(o.data);console.log(e),e.code==="gogo"&&(V.roomMessage=e,V.WebSocket=u,w.push("/game"))},u.onclose=function(){},window.onbeforeunload=function(){u.close()}):alert("\u5F53\u524D\u6D4F\u89C8\u5668 Not support websocket")},h=p(!1),M=()=>{h.value=!0;const o={code:"match",data:{}};u.send(JSON.stringify(o))},J=()=>{u!=null&&(u.close(),u=null)},P=()=>{if(u!=null){h.value=!1;const o={code:"closeMatch",data:{}};u.send(JSON.stringify(o))}};return x(),U(),$(),(o,e)=>{const d=v("el-card"),k=v("el-table-column"),B=v("el-table"),i=v("el-button"),y=v("el-input"),N=v("el-dialog"),R=F("loading");return I(),L(T,null,[n("div",Y,[n("div",Z,[t(d,{class:"box-card"},{header:s(()=>[n("div",ee,[n("span",null,"\u540D\u5B57\uFF1A"+S(a.value.username),1)])]),default:s(()=>[n("div",ae,"\u603B\u573A\u6570\uFF1A"+S(a.value.totalGames),1),n("div",se,"\u80DC\u573A\u6570\uFF1A"+S(a.value.winGames),1),n("div",te,"\u80DC\u7387\uFF1A"+S(a.value.winRate),1)]),_:1}),t(d,{class:"box-card"},{header:s(()=>[oe]),default:s(()=>[m.value.length!=0?(I(),q(B,{key:0,data:m.value,style:{width:"100%"}},{default:s(()=>[t(k,{prop:"firstName",label:"\u5148\u624B"}),t(k,{prop:"secondName",label:"\u540E\u624B"}),t(k,{prop:"winner",label:"\u80DC\u8D1F"}),t(k,{prop:"time",label:"\u65F6\u95F4",width:"160"})]),_:1},8,["data"])):A("",!0)]),_:1})]),n("div",le,[t(d,{class:"box-card"},{header:s(()=>[ne]),default:s(()=>[t(i,{onClick:e[0]||(e[0]=l=>_.value=!0)},{default:s(()=>[de]),_:1}),t(i,{onClick:e[1]||(e[1]=l=>f.value=!0)},{default:s(()=>[re]),_:1})]),_:1}),t(d,{class:"box-card"},{header:s(()=>[ue]),default:s(()=>[t(i,{color:"#626aef",size:"large",onClick:e[2]||(e[2]=l=>M())},{default:s(()=>[ie]),_:1}),t(i,{color:"#626aef",size:"large",onClick:e[3]||(e[3]=l=>J())},{default:s(()=>[ce]),_:1})]),_:1})])]),t(N,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=l=>_.value=l),title:"\u4FEE\u6539\u7528\u6237\u540D",width:"30%","before-close":o.handleClose},{footer:s(()=>[n("span",me,[t(i,{onClick:e[5]||(e[5]=l=>_.value=!1)},{default:s(()=>[pe]),_:1}),t(i,{type:"primary",onClick:e[6]||(e[6]=l=>G())},{default:s(()=>[ve]),_:1})])]),default:s(()=>[t(y,{modelValue:r.value.username,"onUpdate:modelValue":e[4]||(e[4]=l=>r.value.username=l),placeholder:"Please input"},null,8,["modelValue"])]),_:1},8,["modelValue","before-close"]),t(N,{modelValue:f.value,"onUpdate:modelValue":e[12]||(e[12]=l=>f.value=l),title:"\u4FEE\u6539\u5BC6\u7801",width:"30%","before-close":o.handleClose},{footer:s(()=>[n("span",_e,[t(i,{onClick:e[10]||(e[10]=l=>f.value=!1)},{default:s(()=>[fe]),_:1}),t(i,{type:"primary",onClick:e[11]||(e[11]=l=>O())},{default:s(()=>[ge]),_:1})])]),default:s(()=>[t(y,{modelValue:r.value.password,"onUpdate:modelValue":e[8]||(e[8]=l=>r.value.password=l),type:"password",placeholder:"Please input password","show-password":""},null,8,["modelValue"]),t(y,{modelValue:r.value.repassword,"onUpdate:modelValue":e[9]||(e[9]=l=>r.value.repassword=l),type:"password",placeholder:"Please input repassword","show-password":""},null,8,["modelValue"])]),_:1},8,["modelValue","before-close"]),t(N,{modelValue:h.value,"onUpdate:modelValue":e[14]||(e[14]=l=>h.value=l),"show-close":!1},{header:s(({close:l,titleId:D,titleClass:E})=>[n("div",we,[n("h4",{id:D,class:H(E)},"\u6B63\u5728\u5339\u914D\u4E2D...",10,he),n("div",ke,[t(i,{type:"danger",onClick:e[13]||(e[13]=Ve=>P())},{default:s(()=>[be]),_:1})])])]),default:s(()=>[K(n("div",null,null,512),[[R,!0]])]),_:1},8,["modelValue"])],64)}}};var Ce=W(Se,[["__scopeId","data-v-e3c3f88e"]]);export{Ce as default};
